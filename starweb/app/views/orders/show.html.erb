<div class="header">
  <h1 class="page-header">
    Pedidos
  </h1>
  <ol class="breadcrumb">
    <li><a href="">Pedidos</a></li>
    <li><%= link_to "Index", orders_path %></li>
    <li class="active">Ver</li>
  </ol>
</div>

<div id="page-inner">
  <% if current_user.is_secretary? %>
  <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modalProduct"> Agregar producto </button>

  <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modalOrderDetail">Agregar detalles</button>

  <%= link_to 'Editar', edit_order_path(@order), class: 'btn btn-primary' %>
  <%end%>

  <div class="row">
    <div class="col-md-12">
      <div class="col-md-6">
                  <h4>Principal</h4>
          <hr>
        <div class="col-md-6">
            <label><b>Fecha de entrega:</b> <br><%= @order.deliver_date %></label><br>

            <label><b>Cliente:</b> <br>
              <%= @order.client.firstname %>
              <%= @order.client.lastname %> - 
              <%= @order.client.doc_ruc %>
            </label><br>
            
            <label><b>Curso / Club:</b> <br><%= @order.course_club %></label><br>
          </div>
          <div class="col-md-6">
            <label><b>Logo:</b> <br><%= image_tag @order.logo.url(:thumb) %></label><br>

            <label><b>Estado:</b> <br><%= @order.state %></label><br>

            <label><b>Notas:</b> <br><%= @order.notes %></label><br>
          </p>
        </div>
      </div>

      <div class="col-md-6"> 
        <h4>Productos</h4>
        <hr>
        <% @order.products.each do |product| %>
        <% if @order.products.empty? %>
        <p>No ha agregado ningún producto</p>
        <% else %>
        <div class="media">
          <div class="media-left media-middle">
            <a href="#">
              <%= image_tag product.image.url(:thumb), class: 'media-object' %>
            </a>
          </div>
          <div class="media-body">
            <h5 class="media-heading"><%= product.name %></h5>
            <% @order.has_products.each do |hasProduct| %>
            <p><%= hasProduct.specs_f %></p>
            <p><%= hasProduct.specs_b %></p>
            <p><%= hasProduct.quantity %></p>
            <p><%= hasProduct.color %></p>
            <p><%= image_tag hasProduct.design.url(:thumb) %></p>
            <%end%>
          </div>
        </div>
        <hr>
        <%end%>

      </div>
      <%end%>
      <h4>Detalles</h4>     
      <% if @order.order_details.empty? %>
      <p>No ha agregado ningún detalle</p>
      <% else %>
      <div class="table-responsive">
        <table class="table table-striped table-bordered table-hover">
          <thead>
            <tr>
              <th>Nombre</th>
              <th>Número</th>
              <th>Tamaño</th>
            </tr>
          </thead>
          <tbody>
            <% @order.order_details.each do |order_detail| %>   
            <tr>
              <td><%= order_detail.name %></td>
              <td><%= order_detail.number %></td>
              <td><%= order_detail.size %><br> 
              <td style="width: 20px;"><%= link_to '' , order_detail, method: :delete, data: { confirm: 'Estás seguro?' }, class: "fas fa-trash"  %></td>
              </tr>
              <% end %>
            </tbody>
          </table>
        </div>
        <%end%>
      </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="modalProduct" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Agregar producto</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <%= render 'form_has_product', has_product: @hasProduct %>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="modalOrderDetail" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Agregar detalles</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <%= render 'form_order_detail', order_detail: @order_detail %>
          </div>
        </div>
      </div>
    </div>
    <!-- /. PAGE INNER  -->
  </div>
  <!-- /. PAGE WRAPPER  -->
</div>